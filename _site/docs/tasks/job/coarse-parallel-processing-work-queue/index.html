
  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Tasks">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Coarse Parallel Processing Using a Work Queue" />
    

    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Coarse Parallel Processing Using a Work Queue | Kubernetes</title>
<meta property="og:title" content="Coarse Parallel Processing Using a Work Queue" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/tasks/job/coarse-parallel-processing-work-queue/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/tasks/job/coarse-parallel-processing-work-queue/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"name":null,"description":"Production-Grade Container Orchestration","author":null,"@type":"WebPage","url":"http://0.0.0.0:4000/docs/tasks/job/coarse-parallel-processing-work-queue/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"image":null,"headline":"Coarse Parallel Processing Using a Work Queue","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.8 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                  <li><a href="https://kubernetes.io/docs/home/">v1.8</a></li>
                
                  <li><a href="https://v1-7.docs.kubernetes.io/docs/home/">v1.7</a></li>
                
                  <li><a href="https://v1-6.docs.kubernetes.io/docs/home/">v1.6</a></li>
                
                  <li><a href="https://v1-5.docs.kubernetes.io/docs/">v1.5</a></li>
                
                  <li><a href="https://v1-4.docs.kubernetes.io/docs/">v1.4</a></li>
                
                </ul>
              </li>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Tasks</h1>
  <h5>Step-by-step instructions for performing operations with Kubernetes.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/tasks/" class="YAH">TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="任务" href="/docs/tasks/"></a>
    
  

  
    <div class="item" data-title="Install Tools">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Install and Set Up kubectl" href="/docs/tasks/tools/install-kubectl/"></a>
    
  

  

    

    
      <a class="item" data-title="Install Minikube" href="/docs/tasks/tools/install-minikube/"></a>
    
  

  

    

    
      <a class="item" data-title="安装 kubeadm" href="/docs/setup/independent/install-kubeadm/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Configure Pods and Containers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="给容器和Pod分配内存资源" href="/docs/tasks/configure-pod-container/assign-memory-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="给容器和Pod分配CPU资源" href="/docs/tasks/configure-pod-container/assign-cpu-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="给 Pod 配置服务质量等级" href="/docs/tasks/configure-pod-container/quality-service-pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Assign CPU and RAM Resources to a Container" href="/docs/tasks/configure-pod-container/assign-cpu-ram-container/"></a>
    
  

  

    

    
      <a class="item" data-title="Assign Opaque Integer Resources to a Container" href="/docs/tasks/configure-pod-container/opaque-integer-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="配置Pod使用卷作为存储" href="/docs/tasks/configure-pod-container/configure-volume-storage/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/configure-pod-container/configure-persistent-volume-storage/"></a>
    
  

  

    

    
      <a class="item" data-title="配置Pod使用配套的存储卷作为存储" href="/docs/tasks/configure-pod-container/configure-projected-volume-storage/"></a>
    
  

  

    

    
  

  

    

    
      <a class="item" data-title="Configure a Security Context for a Pod or Container" href="/docs/tasks/configure-pod-container/security-context/"></a>
    
  

  

    

    
  

  

    

    
      <a class="item" data-title="配置Pod的Service Account" href="/docs/tasks/configure-pod-container/configure-service-account/"></a>
    
  

  

    

    
      <a class="item" data-title="从私有仓库拉取镜像" href="/docs/tasks/configure-pod-container/pull-image-private-registry/"></a>
    
  

  

    

    
      <a class="item" data-title="配置Liveness和Readiness探针" href="/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/"></a>
    
  

  

    

    
      <a class="item" data-title="向节点分配 Pod" href="/docs/tasks/configure-pod-container/assign-pods-nodes/"></a>
    
  

  

    

    
      <a class="item" data-title="配置Pod初始化" href="/docs/tasks/configure-pod-container/configure-pod-initialization/"></a>
    
  

  

    

    
      <a class="item" data-title="给容器生命周期设置操作事件" href="/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/"></a>
    
  

  

    

    
      <a class="item" data-title="使用ConfigMap配置容器" href="/docs/tasks/configure-pod-container/configmap/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Pod 里使用 ConfigMap 数据" href="/docs/tasks/configure-pod-container/configure-pod-configmap/"></a>
    
  

  

    

    
      <a class="item" data-title="Translate a Docker Compose File to Kubernetes Resources" href="/docs/tools/kompose/user-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Inject Data Into Applications">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Define a Command and Arguments for a Container" href="/docs/tasks/inject-data-application/define-command-argument-container/"></a>
    
  

  

    

    
      <a class="item" data-title="Define Environment Variables for a Container" href="/docs/tasks/inject-data-application/define-environment-variable-container/"></a>
    
  

  

    

    
      <a class="item" data-title="Expose Pod Information to Containers Through Environment Variables" href="/docs/tasks/inject-data-application/environment-variable-expose-pod-information/"></a>
    
  

  

    

    
      <a class="item" data-title="Expose Pod Information to Containers Through Files" href="/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Secrets 安全地分发凭证" href="/docs/tasks/inject-data-application/distribute-credentials-secure/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 PodPreset 将信息注入 Pods" href="/docs/tasks/inject-data-application/podpreset/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Run Applications">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Run a Stateless Application Using a Deployment" href="/docs/tasks/run-application/run-stateless-application-deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="Run a Single-Instance Stateful Application" href="/docs/tasks/run-application/run-single-instance-stateful-application/"></a>
    
  

  

    

    
      <a class="item" data-title="Run a Replicated Stateful Application" href="/docs/tasks/run-application/run-replicated-stateful-application/"></a>
    
  

  

    

    
      <a class="item" data-title="Update API Objects in Place Using kubectl patch" href="/docs/tasks/run-application/update-api-object-kubectl-patch/"></a>
    
  

  

    

    
      <a class="item" data-title="Upgrade from PetSets to StatefulSets" href="/docs/tasks/run-application/upgrade-pet-set-to-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="Scale a StatefulSet" href="/docs/tasks/run-application/scale-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="删除StatefulSet" href="/docs/tasks/run-application/delete-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="强制删除StatefulSet中的Pod" href="/docs/tasks/run-application/force-delete-stateful-set-pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Perform Rolling Update Using a Replication Controller" href="/docs/tasks/run-application/rolling-update-replication-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="Horizontal Pod Autoscaling" href="/docs/tasks/run-application/horizontal-pod-autoscale/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod水平自动伸缩（Horizontal Pod Autoscaling）演练" href="/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/"></a>
    
  

  

    

    
      <a class="item" data-title="指定应用程序的中断预算（Disruption Budget）" href="/docs/tasks/run-application/configure-pdb/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Run Jobs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Parallel Processing using Expansions" href="/docs/tasks/job/parallel-processing-expansion/"></a>
    
  

  

    

    
      <a class="item" data-title="Coarse Parallel Processing Using a Work Queue" href="/docs/tasks/job/coarse-parallel-processing-work-queue/"></a>
    
  

  

    

    
      <a class="item" data-title="Fine Parallel Processing Using a Work Queue" href="/docs/tasks/job/fine-parallel-processing-work-queue/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Access Applications in a Cluster">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Web UI (Dashboard)" href="/docs/tasks/access-application-cluster/web-ui-dashboard/"></a>
    
  

  

    

    
      <a class="item" data-title="访问集群" href="/docs/tasks/access-application-cluster/access-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="配置对多集群的访问" href="/docs/tasks/access-application-cluster/configure-access-multiple-clusters/"></a>
    
  

  

    

    
      <a class="item" data-title="通过端口转发访问集群中的应用程序" href="/docs/tasks/access-application-cluster/port-forward-access-application-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="Provide Load-Balanced Access to an Application in a Cluster" href="/docs/tasks/access-application-cluster/load-balance-access-application-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 service 访问群集中的应用程序" href="/docs/tasks/access-application-cluster/service-access-application-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Service 把前端连接到后端" href="/docs/tasks/access-application-cluster/connecting-frontend-backend/"></a>
    
  

  

    

    
      <a class="item" data-title="创建一个外部负载均衡器" href="/docs/tasks/access-application-cluster/create-external-load-balancer/"></a>
    
  

  

    

    
      <a class="item" data-title="配置云平台防火墙" href="/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/"></a>
    
  

  

    

    
      <a class="item" data-title="List All Container Images Running in a Cluster" href="/docs/tasks/access-application-cluster/list-all-running-container-images/"></a>
    
  

  

    

    
      <a class="item" data-title="同 Pod 内的容器使用共享卷通信" href="/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/"></a>
    
  

  

    

    
      <a class="item" data-title="Configuring DNS for a Cluster" href="https://github.com/kubernetes/kubernetes/tree/release-1.5/examples/cluster-dns"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Monitor, Log, and Debug">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Core metrics pipeline" href="/docs/tasks/debug-application-cluster/core-metrics-pipeline/"></a>
    
  

  

    

    
      <a class="item" data-title="对计算、存储和网络资源进行监控的工具" href="/docs/tasks/debug-application-cluster/resource-usage-monitoring/"></a>
    
  

  

    

    
      <a class="item" data-title="获取一个运行容器的 Shell" href="/docs/tasks/debug-application-cluster/get-shell-running-container/"></a>
    
  

  

    

    
      <a class="item" data-title="监控节点健康状况" href="/docs/tasks/debug-application-cluster/monitor-node-health/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Stackdriver 查看日志" href="/docs/tasks/debug-application-cluster/logging-stackdriver/"></a>
    
  

  

    

    
      <a class="item" data-title="Stackdriver 中的事件" href="/docs/tasks/debug-application-cluster/events-stackdriver/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Elasticsearch 和 Kibana 查看日志" href="/docs/tasks/debug-application-cluster/logging-elasticsearch-kibana/"></a>
    
  

  

    

    
      <a class="item" data-title="确定 Pod 失败的原因" href="/docs/tasks/debug-application-cluster/determine-reason-pod-failure/"></a>
    
  

  

    

    
      <a class="item" data-title="调试 Init 容器" href="/docs/tasks/debug-application-cluster/debug-init-containers/"></a>
    
  

  

    

    
      <a class="item" data-title="Debug Pods and Replication Controllers" href="/docs/tasks/debug-application-cluster/debug-pod-replication-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="Debug Services" href="/docs/tasks/debug-application-cluster/debug-service/"></a>
    
  

  

    

    
      <a class="item" data-title="Troubleshoot Clusters" href="/docs/tasks/debug-application-cluster/debug-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="Troubleshoot Applications" href="/docs/tasks/debug-application-cluster/debug-application/"></a>
    
  

  

    

    
      <a class="item" data-title="Debug a StatefulSet" href="/docs/tasks/debug-application-cluster/debug-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="Application Introspection and Debugging" href="/docs/tasks/debug-application-cluster/debug-application-introspection/"></a>
    
  

  

    

    
      <a class="item" data-title="Auditing" href="/docs/tasks/debug-application-cluster/audit/"></a>
    
  

  

    

    
      <a class="item" data-title="Developing and debugging services locally" href="/docs/tasks/debug-application-cluster/local-debugging/"></a>
    
  

  

    

    
      <a class="item" data-title="Use Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.5/examples/explorer"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extend Kubernetes">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Use an HTTP Proxy to Access the Kubernetes API" href="/docs/tasks/access-kubernetes-api/http-proxy-access-api/"></a>
    
  

  

    

    
      <a class="item" data-title="使用CRD(CustomResourceDefinitions)扩展Kubernetes API" href="/docs/tasks/access-kubernetes-api/extend-api-custom-resource-definitions/"></a>
    
  

  

    

    
      <a class="item" data-title="Extend the Kubernetes API with ThirdPartyResources" href="/docs/tasks/access-kubernetes-api/extend-api-third-party-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="Migrate a ThirdPartyResource to CustomResourceDefinition" href="/docs/tasks/access-kubernetes-api/migrate-third-party-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="Configure the aggregation layer" href="/docs/tasks/access-kubernetes-api/configure-aggregation-layer/"></a>
    
  

  

    

    
      <a class="item" data-title="配置扩展 API 服务器" href="/docs/tasks/access-kubernetes-api/setup-extension-api-server/"></a>
    
  

  

    

    
      <a class="item" data-title="Install Service Catalog using Helm" href="/docs/tasks/service-catalog/install-service-catalog-using-helm/"></a>
    
  

  

    

    
      <a class="item" data-title="Install Service Catalog using SC" href="/docs/tasks/service-catalog/install-service-catalog-using-sc/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="TLS">
      <div class="container">
        
  

    

    
      <a class="item" data-title="管理集群中的TLS认证" href="/docs/tasks/tls/managing-tls-in-a-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="证书轮换" href="/docs/tasks/tls/certificate-rotation/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Administer a Cluster">
      <div class="container">
        
  
    <div class="item" data-title="Manage Memory, CPU, and API Resources">
      <div class="container">
        
  

    

    
      <a class="item" data-title="为命名空间配置默认的内存请求与限额" href="/docs/tasks/administer-cluster/memory-default-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="在命名空间中配置默认的CPU请求与限额" href="/docs/tasks/administer-cluster/cpu-default-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="为 Namespace 设置最小和最大内存限制" href="/docs/tasks/administer-cluster/memory-constraint-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="为 Namespace 配置最小和最大 CPU 限制" href="/docs/tasks/administer-cluster/cpu-constraint-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="应用资源配额和限额" href="/docs/tasks/administer-cluster/apply-resource-quota-limit/"></a>
    
  

  

    

    
      <a class="item" data-title="为名字空间配置CPU和内存配额（Quota）" href="/docs/tasks/administer-cluster/quota-memory-cpu-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="为名字空间配置Pod配额" href="/docs/tasks/administer-cluster/quota-pod-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="配置API对象（API Object）的配额（Quota）" href="/docs/tasks/administer-cluster/quota-api-object/"></a>
    
  

  

    

    
      <a class="item" data-title="为节点发布不透明整数资源（Opaque Integer Resources）" href="/docs/tasks/administer-cluster/opaque-integer-resource-node/"></a>
    
  

  

    

    
      <a class="item" data-title="控制节点上的CPU管理策略" href="/docs/tasks/administer-cluster/cpu-management-policies/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="通过 Kubernetes API 访问集群" href="/docs/tasks/administer-cluster/access-cluster-api/"></a>
    
  

  

    

    
      <a class="item" data-title="访问集群上运行的服务" href="/docs/tasks/administer-cluster/access-cluster-services/"></a>
    
  

  

    

    
      <a class="item" data-title="集群安全" href="/docs/tasks/administer-cluster/securing-a-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="Encrypting data at rest" href="/docs/tasks/administer-cluster/encrypt-data/"></a>
    
  

  

    

    
      <a class="item" data-title="Operating etcd clusters for Kubernetes" href="/docs/tasks/administer-cluster/configure-upgrade-etcd/"></a>
    
  

  

    

    
      <a class="item" data-title="静态 Pod" href="/docs/tasks/administer-cluster/static-pod/"></a>
    
  

  

    

    
      <a class="item" data-title="集群管理" href="/docs/tasks/administer-cluster/cluster-management/"></a>
    
  

  

    

    
      <a class="item" data-title="1.6 版本集群管理指南" href="/docs/tasks/administer-cluster/upgrade-1-6/"></a>
    
  

  

    

    
      <a class="item" data-title="将 kubeadm 集群从 1.6 升级到 1.7" href="/docs/tasks/administer-cluster/kubeadm-upgrade-1-7/"></a>
    
  

  

    

    
      <a class="item" data-title="将 kubeadm 集群从 1.7 升级到 1.8" href="/docs/tasks/administer-cluster/kubeadm-upgrade-1-8/"></a>
    
  

  

    

    
      <a class="item" data-title="使用命名空间共享一个集群" href="/docs/tasks/administer-cluster/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="演示命名空间" href="/docs/tasks/administer-cluster/namespaces-walkthrough/"></a>
    
  

  

    

    
      <a class="item" data-title="集群 DNS Service Autoscale" href="/docs/tasks/administer-cluster/dns-horizontal-autoscaling/"></a>
    
  

  

    

    
      <a class="item" data-title="遵循应用中断预算安全移除节点" href="/docs/tasks/administer-cluster/safely-drain-node/"></a>
    
  

  

    

    
      <a class="item" data-title="设置 Pod CPU 和内存限制" href="/docs/tasks/administer-cluster/cpu-memory-limit/"></a>
    
  

  

    

    
      <a class="item" data-title="配置资源不足处理方式" href="/docs/tasks/administer-cluster/out-of-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="为系统守护进程预留计算资源" href="/docs/tasks/administer-cluster/reserve-compute-resources/"></a>
    
  

  

    

    
      <a class="item" data-title="关键插件 Pod 的调度保证" href="/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/"></a>
    
  

  

    

    
      <a class="item" data-title="声明网络策略" href="/docs/tasks/administer-cluster/declare-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="重新配置活动集群中节点的 Kubelet" href="/docs/tasks/administer-cluster/reconfigure-kubelet/"></a>
    
  

  

    

    
      <a class="item" data-title="通过配置文件设置 Kubelet 参数" href="/docs/tasks/administer-cluster/kubelet-config-file/"></a>
    
  

  
    <div class="item" data-title="Install Network Policy Provider">
      <div class="container">
        
  

    

    
      <a class="item" data-title="为了 NetworkPolicy 使用 Calico" href="/docs/tasks/administer-cluster/calico-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Cilium 来提供 NetworkPolicy" href="/docs/tasks/administer-cluster/cilium-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Kube-router 来提供 NetworkPolicy" href="/docs/tasks/administer-cluster/kube-router-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="为了 NetworkPolicy 使用 Romana" href="/docs/tasks/administer-cluster/romana-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="为了 NetworkPolicy 使用 Weave 网络" href="/docs/tasks/administer-cluster/weave-network-policy/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="更改 PersistentVolume 的回收策略" href="/docs/tasks/administer-cluster/change-pv-reclaim-policy/"></a>
    
  

  

    

    
  

  

    

    
      <a class="item" data-title="限制存储使用量" href="/docs/tasks/administer-cluster/limit-storage-consumption/"></a>
    
  

  

    

    
      <a class="item" data-title="改变默认 StorageClass" href="/docs/tasks/administer-cluster/change-default-storage-class/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes 云管理控制器" href="/docs/tasks/administer-cluster/running-cloud-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="开发云管理控制器（Cloud Controller Manager）" href="/docs/tasks/administer-cluster/developing-cloud-controller-manager/"></a>
    
  

  

    

    
      <a class="item" data-title="建立高可用 Kubernetes Master" href="/docs/tasks/administer-cluster/highly-available-master/"></a>
    
  

  

    

    
      <a class="item" data-title="配置多个调度器" href="/docs/tasks/administer-cluster/configure-multiple-schedulers/"></a>
    
  

  

    

    
      <a class="item" data-title="IP 伪装代理用户指南" href="/docs/tasks/administer-cluster/ip-masq-agent/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Kubernetes 中配置私有 DNS 和上游 nameserver" href="/docs/tasks/administer-cluster/dns-custom-nameservers/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Federation - Run an App on Multiple Clusters">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Cross-cluster Service Discovery using Federated Services" href="/docs/tasks/federation/federation-service-discovery/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Kubefed 创建集群联邦" href="/docs/tasks/federation/set-up-cluster-federation-kubefed/"></a>
    
  

  

    

    
      <a class="item" data-title="Set up CoreDNS as DNS provider for Cluster Federation" href="/docs/tasks/federation/set-up-coredns-provider-federation/"></a>
    
  

  

    

    
      <a class="item" data-title="Set up placement policies in Federation" href="/docs/tasks/federation/set-up-placement-policies-federation/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Cluster" href="/docs/tasks/administer-federation/cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated ConfigMap" href="/docs/tasks/administer-federation/configmap/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated DaemonSet" href="/docs/tasks/administer-federation/daemonset/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Deployment" href="/docs/tasks/administer-federation/deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Events" href="/docs/tasks/administer-federation/events/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Horizontal Pod Autoscalers (HPA)" href="/docs/tasks/administer-federation/hpa/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Ingress" href="/docs/tasks/administer-federation/ingress/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Jobs" href="/docs/tasks/administer-federation/job/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦命名空间" href="/docs/tasks/administer-federation/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated ReplicaSets" href="/docs/tasks/administer-federation/replicaset/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Secrets" href="/docs/tasks/administer-federation/secret/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Manage Cluster Daemons">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Perform a Rolling Update on a DaemonSet" href="/docs/tasks/manage-daemon/update-daemon-set/"></a>
    
  

  

    

    
      <a class="item" data-title="对 DaemonSet 执行回滚" href="/docs/tasks/manage-daemon/rollback-daemon-set/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Manage GPUs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="调度 GPU" href="/docs/tasks/manage-gpus/scheduling-gpus/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Manage HugePages">
      <div class="container">
        
  

    

    
      <a class="item" data-title="管理巨页（HugePages）" href="/docs/tasks/manage-hugepages/scheduling-hugepages/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extend kubectl with plugins">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Extend kubectl with plugins" href="/docs/tasks/extend-kubectl/kubectl-plugins/"></a>
    
  


      </div>
    </div>
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/tasks/job/coarse-parallel-processing-work-queue/index.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Coarse Parallel Processing Using a Work Queue</h1>
        

        <ul id="markdown-toc">
  <li><a href="#example-job-with-work-queue-with-pod-per-work-item" id="markdown-toc-example-job-with-work-queue-with-pod-per-work-item">Example: Job with Work Queue with Pod Per Work Item</a>    <ul>
      <li><a href="#starting-a-message-queue-service" id="markdown-toc-starting-a-message-queue-service">Starting a message queue service</a></li>
      <li><a href="#testing-the-message-queue-service" id="markdown-toc-testing-the-message-queue-service">Testing the message queue service</a></li>
      <li><a href="#filling-the-queue-with-tasks" id="markdown-toc-filling-the-queue-with-tasks">Filling the Queue with tasks</a></li>
      <li><a href="#create-an-image" id="markdown-toc-create-an-image">Create an Image</a></li>
      <li><a href="#defining-a-job" id="markdown-toc-defining-a-job">Defining a Job</a></li>
      <li><a href="#running-the-job" id="markdown-toc-running-the-job">Running the Job</a></li>
      <li><a href="#alternatives" id="markdown-toc-alternatives">Alternatives</a></li>
      <li><a href="#caveats" id="markdown-toc-caveats">Caveats</a></li>
    </ul>
  </li>
</ul>

<h1 id="example-job-with-work-queue-with-pod-per-work-item">Example: Job with Work Queue with Pod Per Work Item</h1>

<p>In this example, we will run a Kubernetes Job with multiple parallel
worker processes.  You may want to be familiar with the basic,
non-parallel, use of <a href="/docs/concepts/jobs/run-to-completion-finite-workloads/">Job</a> first.</p>

<p>In this example, as each pod is created, it picks up one unit of work
from a task queue, completes it, deletes it from the queue, and exits.</p>

<p>Here is an overview of the steps in this example:</p>

<ol>
  <li><strong>Start a message queue service.</strong>  In this example, we use RabbitMQ, but you could use another
  one.  In practice you would set up a message queue service once and reuse it for many jobs.</li>
  <li><strong>Create a queue, and fill it with messages.</strong>  Each message represents one task to be done.  In
  this example, a message is just an integer that we will do a lengthy computation on.</li>
  <li><strong>Start a Job that works on tasks from the queue</strong>.  The Job starts several pods.  Each pod takes
  one task from the message queue, processes it, and repeats until the end of the queue is reached.</li>
</ol>

<h2 id="starting-a-message-queue-service">Starting a message queue service</h2>

<p>This example uses RabbitMQ, but it should be easy to adapt to another AMQP-type message service.</p>

<p>In practice you could set up a message queue service once in a
cluster and reuse it for many jobs, as well as for long-running services.</p>

<p>Start RabbitMQ as follows:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> examples/celery-rabbitmq/rabbitmq-service.yaml
service <span class="s2">"rabbitmq-service"</span> created
<span class="nv">$ </span>kubectl create <span class="nt">-f</span> examples/celery-rabbitmq/rabbitmq-controller.yaml
replicationcontroller <span class="s2">"rabbitmq-controller"</span> created
</code></pre></div></div>

<p>We will only use the rabbitmq part from the <a href="https://github.com/kubernetes/kubernetes/tree/release-1.3/examples/celery-rabbitmq">celery-rabbitmq example</a>.</p>

<h2 id="testing-the-message-queue-service">Testing the message queue service</h2>

<p>Now, we can experiment with accessing the message queue.  We will
create a temporary interactive pod, install some tools on it,
and experiment with queues.</p>

<p>First create a temporary interactive Pod.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create a temporary interactive container</span>
<span class="nv">$ </span>kubectl run <span class="nt">-i</span> <span class="nt">--tty</span> temp <span class="nt">--image</span> ubuntu:14.04
Waiting <span class="k">for </span>pod default/temp-loe07 to be running, status is Pending, pod ready: <span class="nb">false</span>
... <span class="o">[</span> previous line repeats several <span class="nb">times</span> .. hit <span class="k">return </span>when it stops <span class="o">]</span> ...
</code></pre></div></div>

<p>Note that your pod name and command prompt will be different.</p>

<p>Next install the <code class="highlighter-rouge">amqp-tools</code> so we can work with message queues.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install some tools</span>
root@temp-loe07:/# apt-get update
.... <span class="o">[</span> lots of output <span class="o">]</span> ....
root@temp-loe07:/# apt-get install <span class="nt">-y</span> curl ca-certificates amqp-tools python dnsutils
.... <span class="o">[</span> lots of output <span class="o">]</span> ....
</code></pre></div></div>

<p>Later, we will make a docker image that includes these packages.</p>

<p>Next, we will check that we can discover the rabbitmq service:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Note the rabbitmq-service has a DNS name, provided by Kubernetes:

root@temp-loe07:/# nslookup rabbitmq-service
Server:        10.0.0.10
Address:    10.0.0.10#53

Name:    rabbitmq-service.default.svc.cluster.local
Address: 10.0.147.152

# Your address will vary.
</code></pre></div></div>

<p>If Kube-DNS is not setup correctly, the previous step may not work for you.
You can also find the service IP in an env var:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># env | grep RABBIT | grep HOST
RABBITMQ_SERVICE_SERVICE_HOST=10.0.147.152
# Your address will vary.
</code></pre></div></div>

<p>Next we will verify we can create a queue, and publish and consume messages.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In the next line, rabbitmq-service is the hostname where the rabbitmq-service</span>
<span class="c"># can be reached.  5672 is the standard port for rabbitmq.</span>

root@temp-loe07:/# <span class="nb">export </span><span class="nv">BROKER_URL</span><span class="o">=</span>amqp://guest:guest@rabbitmq-service:5672
<span class="c"># If you could not resolve "rabbitmq-service" in the previous step,</span>
<span class="c"># then use this command instead:</span>
<span class="c"># root@temp-loe07:/# BROKER_URL=amqp://guest:guest@$RABBITMQ_SERVICE_SERVICE_HOST:5672</span>

<span class="c"># Now create a queue:</span>

root@temp-loe07:/# /usr/bin/amqp-declare-queue <span class="nt">--url</span><span class="o">=</span><span class="nv">$BROKER_URL</span> <span class="nt">-q</span> foo <span class="nt">-d</span>
foo

<span class="c"># Publish one message to it:</span>

root@temp-loe07:/# /usr/bin/amqp-publish <span class="nt">--url</span><span class="o">=</span><span class="nv">$BROKER_URL</span> <span class="nt">-r</span> foo <span class="nt">-p</span> <span class="nt">-b</span> Hello

<span class="c"># And get it back.</span>

root@temp-loe07:/# /usr/bin/amqp-consume <span class="nt">--url</span><span class="o">=</span><span class="nv">$BROKER_URL</span> <span class="nt">-q</span> foo <span class="nt">-c</span> 1 <span class="nb">cat</span> <span class="o">&amp;&amp;</span> <span class="nb">echo
</span>Hello
root@temp-loe07:/#
</code></pre></div></div>

<p>In the last command, the <code class="highlighter-rouge">amqp-consume</code> tool takes one message (<code class="highlighter-rouge">-c 1</code>)
from the queue, and passes that message to the standard input of an arbitrary command.  In this case, the program <code class="highlighter-rouge">cat</code> is just printing
out what it gets on the standard input, and the echo is just to add a carriage
return so the example is readable.</p>

<h2 id="filling-the-queue-with-tasks">Filling the Queue with tasks</h2>

<p>Now lets fill the queue with some “tasks”.  In our example, our tasks are just strings to be
printed.</p>

<p>In a practice, the content of the messages might be:</p>

<ul>
  <li>names of files to that need to be processed</li>
  <li>extra flags to the program</li>
  <li>ranges of keys in a database table</li>
  <li>configuration parameters to a simulation</li>
  <li>frame numbers of a scene to be rendered</li>
</ul>

<p>In practice, if there is large data that is needed in a read-only mode by all pods
of the Job, you will typically put that in a shared file system like NFS and mount
that readonly on all the pods, or the program in the pod will natively read data from
a cluster file system like HDFS.</p>

<p>For our example, we will create the queue and fill it using the amqp command line tools.
In practice, you might write a program to fill the queue using an amqp client library.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>/usr/bin/amqp-declare-queue <span class="nt">--url</span><span class="o">=</span><span class="nv">$BROKER_URL</span> <span class="nt">-q</span> job1  <span class="nt">-d</span>
job1
<span class="nv">$ </span><span class="k">for </span>f <span class="k">in </span>apple banana cherry date fig grape lemon melon
<span class="k">do</span>
  /usr/bin/amqp-publish <span class="nt">--url</span><span class="o">=</span><span class="nv">$BROKER_URL</span> <span class="nt">-r</span> job1 <span class="nt">-p</span> <span class="nt">-b</span> <span class="nv">$f</span>
<span class="k">done</span>
</code></pre></div></div>

<p>So, we filled the queue with 8 messages.</p>

<h2 id="create-an-image">Create an Image</h2>

<p>Now we are ready to create an image that we will run as a job.</p>

<p>We will use the <code class="highlighter-rouge">amqp-consume</code> utility to read the message
from the queue and run our actual program.  Here is a very simple
example program:</p>

<table class="includecode">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/docs/tasks/job/coarse-parallel-processing-work-queue/worker.py" download="worker.py">
                    <code>worker.py</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('worker.py')" title="Copy worker.py to clipboard" />
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
<div id="worker.py" class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env python</span>

<span class="c"># Just prints standard out and sleeps for 10 seconds.</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Processing "</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">lines</span><span class="p">())</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>
</td>
        </tr>
    </tbody>
</table>

<p>Now, build an image.  If you are working in the source
tree, then change directory to <code class="highlighter-rouge">examples/job/work-queue-1</code>.
Otherwise, make a temporary directory, change to it,
download the <a href="Dockerfile?raw=true">Dockerfile</a>,
and <a href="worker.py?raw=true">worker.py</a>.  In either case,
build the image with this command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker build <span class="nt">-t</span> job-wq-1 <span class="nb">.</span>
</code></pre></div></div>

<p>For the <a href="https://hub.docker.com/">Docker Hub</a>, tag your app image with
your username and push to the Hub with the below commands. Replace
<code class="highlighter-rouge">&lt;username&gt;</code> with your Hub username.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker tag job-wq-1 &lt;username&gt;/job-wq-1
docker push &lt;username&gt;/job-wq-1
</code></pre></div></div>

<p>If you are using <a href="https://cloud.google.com/tools/container-registry/">Google Container
Registry</a>, tag
your app image with your project ID, and push to GCR. Replace
<code class="highlighter-rouge">&lt;project&gt;</code> with your project ID.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker tag job-wq-1 gcr.io/&lt;project&gt;/job-wq-1
gcloud docker <span class="nt">--</span> push gcr.io/&lt;project&gt;/job-wq-1
</code></pre></div></div>

<h2 id="defining-a-job">Defining a Job</h2>

<p>Here is a job definition.  You’ll need to make a copy of the Job and edit the
image to match the name you used, and call it <code class="highlighter-rouge">./job.yaml</code>.</p>

<table class="includecode">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/docs/tasks/job/coarse-parallel-processing-work-queue/job.yaml" download="job.yaml">
                    <code>job.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('job.yaml')" title="Copy job.yaml to clipboard" />
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
<div id="job.yaml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">batch/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Job</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">job-wq-1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">completions</span><span class="pi">:</span> <span class="s">8</span>
  <span class="na">parallelism</span><span class="pi">:</span> <span class="s">2</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">job-wq-1</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">c</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">gcr.io/&lt;project&gt;/job-wq-1</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">BROKER_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">amqp://guest:guest@rabbitmq-service:5672</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">QUEUE</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">job1</span>
      <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">OnFailure</span>
</code></pre></div></div>
</td>
        </tr>
    </tbody>
</table>

<p>In this example, each pod works on one item from the queue and then exits.
So, the completion count of the Job corresponds to the number of work items
done.  So we set, <code class="highlighter-rouge">.spec.completions: 8</code> for the example, since we put 8 items in the queue.</p>

<h2 id="running-the-job">Running the Job</h2>

<p>So, now run the Job:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create <span class="nt">-f</span> ./job.yaml
</code></pre></div></div>

<p>Now wait a bit, then check on the job.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl describe <span class="nb">jobs</span>/job-wq-1
Name:             job-wq-1
Namespace:        default
Selector:         controller-uid<span class="o">=</span>41d75705-92df-11e7-b85e-fa163ee3c11f
Labels:           controller-uid<span class="o">=</span>41d75705-92df-11e7-b85e-fa163ee3c11f
                  job-name<span class="o">=</span>job-wq-1
Annotations:      &lt;none&gt;
Parallelism:      2
Completions:      8
Start Time:       Wed, 06 Sep 2017 16:42:02 +0800
Pods Statuses:    0 Running / 8 Succeeded / 0 Failed
Pod Template:
  Labels:       controller-uid<span class="o">=</span>41d75705-92df-11e7-b85e-fa163ee3c11f
                job-name<span class="o">=</span>job-wq-1
  Containers:
   c:
    Image:      gcr.io/causal-jigsaw-637/job-wq-1
    Port:
    Environment:
      BROKER_URL:       amqp://guest:guest@rabbitmq-service:5672
      QUEUE:            job1
    Mounts:             &lt;none&gt;
  Volumes:              &lt;none&gt;
Events:
  FirstSeen  LastSeen   Count    From    SubobjectPath    Type      Reason              Message
  ─────────  ────────   ─────    ────    ─────────────    ──────    ──────              ───────
  27s        27s        1        <span class="o">{</span>job <span class="o">}</span>                   Normal    SuccessfulCreate    Created pod: job-wq-1-hcobb
  27s        27s        1        <span class="o">{</span>job <span class="o">}</span>                   Normal    SuccessfulCreate    Created pod: job-wq-1-weytj
  27s        27s        1        <span class="o">{</span>job <span class="o">}</span>                   Normal    SuccessfulCreate    Created pod: job-wq-1-qaam5
  27s        27s        1        <span class="o">{</span>job <span class="o">}</span>                   Normal    SuccessfulCreate    Created pod: job-wq-1-b67sr
  26s        26s        1        <span class="o">{</span>job <span class="o">}</span>                   Normal    SuccessfulCreate    Created pod: job-wq-1-xe5hj
  15s        15s        1        <span class="o">{</span>job <span class="o">}</span>                   Normal    SuccessfulCreate    Created pod: job-wq-1-w2zqe
  14s        14s        1        <span class="o">{</span>job <span class="o">}</span>                   Normal    SuccessfulCreate    Created pod: job-wq-1-d6ppa
  14s        14s        1        <span class="o">{</span>job <span class="o">}</span>                   Normal    SuccessfulCreate    Created pod: job-wq-1-p17e0
</code></pre></div></div>

<p>All our pods succeeded.  Yay.</p>

<h2 id="alternatives">Alternatives</h2>

<p>This approach has the advantage that you
do not need to modify your “worker” program to be aware that there is a work queue.</p>

<p>It does require that you run a message queue service.
If running a queue service is inconvenient, you may
want to consider one of the other <a href="/docs/concepts/jobs/run-to-completion-finite-workloads/#job-patterns">job patterns</a>.</p>

<p>This approach creates a pod for every work item.  If your work items only take a few seconds,
though, creating a Pod for every work item may add a lot of overhead.  Consider another
<a href="/docs/tasks/job/fine-parallel-processing-work-queue/">example</a>, that executes multiple work items per Pod.</p>

<p>In this example, we used use the <code class="highlighter-rouge">amqp-consume</code> utility to read the message
from the queue and run our actual program.  This has the advantage that you
do not need to modify your program to be aware of the queue.
A <a href="/docs/tasks/job/fine-parallel-processing-work-queue/">different example</a>, shows how to
communicate with the work queue using a client library.</p>

<h2 id="caveats">Caveats</h2>

<p>If the number of completions is set to less than the number of items in the queue, then
not all items will be processed.</p>

<p>If the number of completions is set to more than the number of items in the queue,
then the Job will not appear to be completed, even though all items in the queue
have been processed.  It will start additional pods which will block waiting
for a message.</p>

<p>There is an unlikely race with this pattern.  If the container is killed in between the time
that the message is acknowledged by the amqp-consume command and the time that the container
exits with success, or if the node crashes before the kubelet is able to post the success of the pod
back to the api-server, then the Job will not appear to be complete, even though all items
in the queue have been processed.</p>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/tasks/job/coarse-parallel-processing-work-queue/index.md?pixel" alt="Analytics" /></a></p>
        
	
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/tasks/job/coarse-parallel-processing-work-queue/",
                "title" : "Coarse Parallel Processing Using a Work Queue",
                "permalink" : "http://kubernetes.github.io/docs/tasks/job/coarse-parallel-processing-work-queue/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
	
        
          <a href="/editdocs#docs/tasks/job/coarse-parallel-processing-work-queue/index.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
