
  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Setup">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Fedora (Multi Node)" />
    

    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Fedora (Multi Node) | Kubernetes</title>
<meta property="og:title" content="Fedora (Multi Node)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/getting-started-guides/fedora/flannel_multi_node_cluster/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/getting-started-guides/fedora/flannel_multi_node_cluster/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"name":null,"description":"Production-Grade Container Orchestration","author":null,"@type":"WebPage","url":"http://0.0.0.0:4000/docs/getting-started-guides/fedora/flannel_multi_node_cluster/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"image":null,"headline":"Fedora (Multi Node)","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.8 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                  <li><a href="https://kubernetes.io/docs/home/">v1.8</a></li>
                
                  <li><a href="https://v1-7.docs.kubernetes.io/docs/home/">v1.7</a></li>
                
                  <li><a href="https://v1-6.docs.kubernetes.io/docs/home/">v1.6</a></li>
                
                  <li><a href="https://v1-5.docs.kubernetes.io/docs/">v1.5</a></li>
                
                  <li><a href="https://v1-4.docs.kubernetes.io/docs/">v1.4</a></li>
                
                </ul>
              </li>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Setup</h1>
  <h5>Instructions for setting up a Kubernetes cluster.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" class="YAH">SETUP</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="Setup" href="/docs/setup/"></a>
    
  

  

    

    
      <a class="item" data-title="Picking the Right Solution" href="/docs/setup/pick-right-solution/"></a>
    
  

  
    <div class="item" data-title="Independent Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Running Kubernetes Locally via Minikube" href="/docs/getting-started-guides/minikube/"></a>
    
  

  
    <div class="item" data-title="Bootstrapping Clusters with kubeadm">
      <div class="container">
        
  

    

    
      <a class="item" data-title="安装 kubeadm" href="/docs/setup/independent/install-kubeadm/"></a>
    
  

  

    

    
      <a class="item" data-title="Using kubeadm to Create a Cluster" href="/docs/setup/independent/create-cluster-kubeadm/"></a>
    
  

  

    

    
      <a class="item" data-title="Troubleshooting kubeadm" href="/docs/setup/independent/troubleshooting-kubeadm/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="从零开始搭建自定义集群" href="/docs/getting-started-guides/scratch/"></a>
    
  

  

    

    
      <a class="item" data-title="Deprecated Alternatives" href="/docs/getting-started-guides/alternatives/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Hosted Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Running Kubernetes on Google Kubernetes Engine" href="https://cloud.google.com/kubernetes-engine/docs/before-you-begin/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on Azure Container Service" href="https://docs.microsoft.com/en-us/azure/container-service/container-service-kubernetes-walkthrough"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on IBM Cloud Container Service" href="https://console.bluemix.net/docs/containers/container_index.html"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Turn-key Cloud Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="在 Google 计算引擎上运行 Kubernetes" href="/docs/getting-started-guides/gce/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/getting-started-guides/aws/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Azure 上运行 Kubernetes" href="/docs/getting-started-guides/azure/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on Alibaba Cloud" href="/docs/getting-started-guides/alibaba-cloud/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/getting-started-guides/clc/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on IBM Cloud" href="https://github.com/patrocinio/kubernetes-softlayer"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on Multiple Clouds with Stackpoint.io" href="/docs/getting-started-guides/stackpoint/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Custom Solutions">
      <div class="container">
        
  
    <div class="item" data-title="Custom Cloud Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes on Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    
  

  

    

    
      <a class="item" data-title="概览" href="/docs/getting-started-guides/kops/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Kubespray 在基础设施或云平台上安装 Kubernetes" href="/docs/getting-started-guides/kubespray/"></a>
    
  

  

    

    
  


      </div>
    </div>
  

  
    <div class="item" data-title="On-Premise VMs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    
  

  

    

    
      <a class="item" data-title="VMware vSphere" href="/docs/getting-started-guides/vsphere/"></a>
    
  

  

    

    
      <a class="item" data-title="VMware Photon Controller" href="/docs/getting-started-guides/photon-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    
  

  

    

    
      <a class="item" data-title="CoreOS on libvirt" href="/docs/getting-started-guides/libvirt-coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    
  

  

    

    
      <a class="item" data-title="OpenStack Heat" href="/docs/getting-started-guides/openstack-heat/"></a>
    
  

  
    <div class="item" data-title="rkt">
      <div class="container">
        
  

    

    
      <a class="item" data-title="通过 rkt 运行 Kubernetes" href="/docs/getting-started-guides/rkt/"></a>
    
  

  

    

    
      <a class="item" data-title="Known Issues when Using rkt" href="/docs/getting-started-guides/rkt/notes/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Kubernetes on Mesos" href="/docs/getting-started-guides/mesos/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes on Mesos on Docker" href="/docs/getting-started-guides/mesos-docker/"></a>
    
  

  
    <div class="item" data-title="Bare Metal">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    
  

  

    

    
      <a class="item" data-title="Fedora via Ansible" href="/docs/getting-started-guides/fedora/fedora_ansible_config/"></a>
    
  

  

    

    
      <a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    
  

  

    

    
      <a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="CentOS" href="/docs/getting-started-guides/centos/centos_manual_config/"></a>
    
  

  

    

    
      <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes on Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    
  

  
    <div class="item" data-title="Ubuntu">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes on Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    
  

  

    

    
      <a class="item" data-title="Validation - End-to-end Testing" href="/docs/getting-started-guides/ubuntu/validation/"></a>
    
  

  

    

    
      <a class="item" data-title="备份" href="/docs/getting-started-guides/ubuntu/backups/"></a>
    
  

  

    

    
      <a class="item" data-title="Upgrades" href="/docs/getting-started-guides/ubuntu/upgrades/"></a>
    
  

  

    

    
      <a class="item" data-title="Scaling" href="/docs/getting-started-guides/ubuntu/scaling/"></a>
    
  

  

    

    
      <a class="item" data-title="Setting up Kubernetes with Juju" href="/docs/getting-started-guides/ubuntu/installation/"></a>
    
  

  

    

    
      <a class="item" data-title="监控" href="/docs/getting-started-guides/ubuntu/monitoring/"></a>
    
  

  

    

    
      <a class="item" data-title="Networking" href="/docs/getting-started-guides/ubuntu/networking/"></a>
    
  

  

    

    
      <a class="item" data-title="Security Considerations" href="/docs/getting-started-guides/ubuntu/security/"></a>
    
  

  

    

    
      <a class="item" data-title="Storage" href="/docs/getting-started-guides/ubuntu/storage/"></a>
    
  

  

    

    
      <a class="item" data-title="Troubleshooting" href="/docs/getting-started-guides/ubuntu/troubleshooting/"></a>
    
  

  

    

    
      <a class="item" data-title="Decommissioning" href="/docs/getting-started-guides/ubuntu/decommissioning/"></a>
    
  

  

    

    
      <a class="item" data-title="Operational Considerations" href="/docs/getting-started-guides/ubuntu/operational-considerations/"></a>
    
  

  

    

    
      <a class="item" data-title="Glossary and Terminology" href="/docs/getting-started-guides/ubuntu/glossary/"></a>
    
  

  

    

    
      <a class="item" data-title="Local Kubernetes development with LXD" href="/docs/getting-started-guides/ubuntu/local/"></a>
    
  

  

    

    
      <a class="item" data-title="日志" href="/docs/getting-started-guides/ubuntu/logging/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Windows Server 容器" href="/docs/getting-started-guides/windows/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Validate Node Setup" href="/docs/admin/node-conformance/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="安装扩展（Addons）" href="/docs/concepts/cluster-administration/addons/"></a>
    
  

  

    

    
      <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    
  

  

    

    
      <a class="item" data-title="搭建大型集群" href="/docs/admin/cluster-large/"></a>
    
  

  

    

    
      <a class="item" data-title="Running in Multiple Zones" href="/docs/admin/multiple-zones/"></a>
    
  

  

    

    
      <a class="item" data-title="构建高可用集群" href="/docs/admin/high-availability/"></a>
    
  

  

    

    
      <a class="item" data-title="下载或构建 Kubernetes" href="/docs/getting-started-guides/binary_release/"></a>
    
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/getting-started-guides/fedora/flannel_multi_node_cluster.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Fedora (Multi Node)</h1>
        

        <ul id="markdown-toc">
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#master-setup" id="markdown-toc-master-setup">Master Setup</a></li>
  <li><a href="#node-setup" id="markdown-toc-node-setup">Node Setup</a></li>
  <li><a href="#test-the-cluster-and-flannel-configuration" id="markdown-toc-test-the-cluster-and-flannel-configuration"><strong>Test the cluster and flannel configuration</strong></a></li>
  <li><a href="#support-level" id="markdown-toc-support-level">Support Level</a></li>
</ul>

<p>This document describes how to deploy Kubernetes on multiple hosts to set up a multi-node cluster and networking with flannel. Follow fedora <a href="/docs/getting-started-guides/fedora/fedora_manual_config/">getting started guide</a> to setup 1 master (fed-master) and 2 or more nodes. Make sure that all nodes have different names (fed-node1, fed-node2 and so on) and labels (fed-node1-label, fed-node2-label, and so on) to avoid any conflict. Also make sure that the Kubernetes master host is running etcd, kube-controller-manager, kube-scheduler, and kube-apiserver services, and the nodes are running docker, kube-proxy and kubelet services. Now install flannel on Kubernetes nodes. Flannel on each node configures an overlay network that docker uses. Flannel runs on each node to setup a unique class-C container network.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>You need 2 or more machines with Fedora installed.</p>

<h2 id="master-setup">Master Setup</h2>

<p><strong>Perform following commands on the Kubernetes master</strong></p>

<ul>
  <li>Configure flannel by creating a <code class="highlighter-rouge">flannel-config.json</code> in your current directory on fed-master. Flannel provides udp and vxlan among other overlay networking backend options. In this guide, we choose kernel based vxlan backend. The contents of the json are:</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"Network"</span><span class="p">:</span><span class="w"> </span><span class="s2">"18.16.0.0/16"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"SubnetLen"</span><span class="p">:</span><span class="w"> </span><span class="mi">24</span><span class="p">,</span><span class="w">
    </span><span class="s2">"Backend"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vxlan"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"VNI"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
     </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>NOTE:</strong> Choose an IP range that is <em>NOT</em> part of the public IP address range.</p>

<p>Add the configuration to the etcd server on fed-master.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>etcdctl <span class="nb">set</span> /coreos.com/network/config &lt; flannel-config.json
</code></pre></div></div>

<ul>
  <li>Verify that the key exists in the etcd server on fed-master.</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>etcdctl get /coreos.com/network/config
</code></pre></div></div>

<h2 id="node-setup">Node Setup</h2>

<p><strong>Perform following commands on all Kubernetes nodes</strong></p>

<p>Install the flannel package</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># dnf -y install flannel</span>
</code></pre></div></div>

<p>Edit the flannel configuration file /etc/sysconfig/flanneld as follows:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Flanneld configuration options</span>

<span class="c"># etcd url location.  Point this to the server where etcd runs</span>
<span class="nv">FLANNEL_ETCD</span><span class="o">=</span><span class="s2">"http://fed-master:2379"</span>

<span class="c"># etcd config key.  This is the configuration key that flannel queries</span>
<span class="c"># For address range assignment</span>
<span class="nv">FLANNEL_ETCD_KEY</span><span class="o">=</span><span class="s2">"/coreos.com/network"</span>

<span class="c"># Any additional options that you want to pass</span>
<span class="nv">FLANNEL_OPTIONS</span><span class="o">=</span><span class="s2">""</span>
</code></pre></div></div>

<p><strong>Note:</strong> By default, flannel uses the interface for the default route. If you have multiple interfaces and would like to use an interface other than the default route one, you could add “-iface=” to FLANNEL_OPTIONS. For additional options, run <code class="highlighter-rouge">flanneld --help</code> on command line.</p>

<p>Enable the flannel service.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable </span>flanneld
</code></pre></div></div>

<p>If docker is not running, then starting flannel service is enough and skip the next step.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start flanneld
</code></pre></div></div>

<p>If docker is already running, then stop docker, delete docker bridge (docker0), start flanneld and restart docker as follows. Another alternative is to just reboot the system (<code class="highlighter-rouge">systemctl reboot</code>).</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop docker
ip link delete docker0
systemctl start flanneld
systemctl start docker
</code></pre></div></div>

<h2 id="test-the-cluster-and-flannel-configuration"><strong>Test the cluster and flannel configuration</strong></h2>

<p>Now check the interfaces on the nodes. Notice there is now a flannel.1 interface, and the ip addresses of docker0 and flannel.1 interfaces are in the same network. You will notice that docker0 is assigned a subnet (18.16.29.0/24 as shown below) on each Kubernetes node out of the IP range configured above. A working output should look like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ip -4 a|grep inet</span>
    inet 127.0.0.1/8 scope host lo
    inet 192.168.122.77/24 brd 192.168.122.255 scope global dynamic eth0
    inet 18.16.29.0/16 scope global flannel.1
    inet 18.16.29.1/24 scope global docker0
</code></pre></div></div>

<p>From any node in the cluster, check the cluster members by issuing a query to etcd server via curl (only partial output is shown using <code class="highlighter-rouge">grep -E "\{|\}|key|value"</code>). If you set up a 1 master and 3 nodes cluster, you should see one block for each node showing the subnets they have been assigned. You can associate those subnets to each node by the MAC address (VtepMAC) and IP address (Public IP) that is listed in the output.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> http://fed-master:2379/v2/keys/coreos.com/network/subnets | python <span class="nt">-mjson</span>.tool
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"node"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/coreos.com/network/subnets"</span><span class="p">,</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/coreos.com/network/subnets/18.16.29.0-24"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">PublicIP</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">192.168.122.77</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">BackendType</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">vxlan</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">BackendData</span><span class="se">\"</span><span class="s2">:{</span><span class="se">\"</span><span class="s2">VtepMAC</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">46:f1:d0:18:d0:65</span><span class="se">\"</span><span class="s2">}}"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/coreos.com/network/subnets/18.16.83.0-24"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">PublicIP</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">192.168.122.36</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">BackendType</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">vxlan</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">BackendData</span><span class="se">\"</span><span class="s2">:{</span><span class="se">\"</span><span class="s2">VtepMAC</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">ca:38:78:fc:72:29</span><span class="se">\"</span><span class="s2">}}"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/coreos.com/network/subnets/18.16.90.0-24"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">PublicIP</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">192.168.122.127</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">BackendType</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">vxlan</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">BackendData</span><span class="se">\"</span><span class="s2">:{</span><span class="se">\"</span><span class="s2">VtepMAC</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">92:e2:80:ba:2d:4d</span><span class="se">\"</span><span class="s2">}}"</span><span class="w">
            </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>From all nodes, review the <code class="highlighter-rouge">/run/flannel/subnet.env</code> file.  This file was generated automatically by flannel.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cat /run/flannel/subnet.env</span>
<span class="nv">FLANNEL_SUBNET</span><span class="o">=</span>18.16.29.1/24
<span class="nv">FLANNEL_MTU</span><span class="o">=</span>1450
<span class="nv">FLANNEL_IPMASQ</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div></div>

<p>At this point, we have etcd running on the Kubernetes master, and flannel / docker running on Kubernetes nodes. Next steps are for testing cross-host container communication which will confirm that docker and flannel are configured properly.</p>

<p>Issue the following commands on any 2 nodes:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># docker run -it fedora:latest bash</span>
bash-4.3# 
</code></pre></div></div>

<p>This will place you inside the container. Install iproute and iputils packages to install ip and ping utilities. Due to a <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1142311">bug</a>, it is required to modify capabilities of ping binary to work around “Operation not permitted” error.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-4.3# dnf <span class="nt">-y</span> install iproute iputils
bash-4.3# setcap cap_net_raw-ep /usr/bin/ping
</code></pre></div></div>

<p>Now note the IP address on the first node:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-4.3# ip <span class="nt">-4</span> a l eth0 | <span class="nb">grep </span>inet
    inet 18.16.29.4/24 scope global eth0
</code></pre></div></div>

<p>And also note the IP address on the other node:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-4.3# ip a l eth0 | <span class="nb">grep </span>inet
    inet 18.16.90.4/24 scope global eth0
</code></pre></div></div>
<p>Now ping from the first node to the other node:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-4.3# ping 18.16.90.4
PING 18.16.90.4 <span class="o">(</span>18.16.90.4<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 18.16.90.4: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>62 <span class="nb">time</span><span class="o">=</span>0.275 ms
64 bytes from 18.16.90.4: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>62 <span class="nb">time</span><span class="o">=</span>0.372 ms
</code></pre></div></div>

<p>Now Kubernetes multi-node cluster is set up with overlay networking set up by flannel.</p>

<h2 id="support-level">Support Level</h2>

<table>
  <thead>
    <tr>
      <th>IaaS Provider</th>
      <th>Config. Mgmt</th>
      <th>OS</th>
      <th>Networking</th>
      <th>Docs</th>
      <th>Conforms</th>
      <th>Support Level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Bare-metal</td>
      <td>custom</td>
      <td>Fedora</td>
      <td>flannel</td>
      <td><a href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/">docs</a></td>
      <td> </td>
      <td>Community (<a href="https://github.com/aveshagarwal">@aveshagarwal</a>)</td>
    </tr>
    <tr>
      <td>libvirt</td>
      <td>custom</td>
      <td>Fedora</td>
      <td>flannel</td>
      <td><a href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/">docs</a></td>
      <td> </td>
      <td>Community (<a href="https://github.com/aveshagarwal">@aveshagarwal</a>)</td>
    </tr>
    <tr>
      <td>KVM</td>
      <td>custom</td>
      <td>Fedora</td>
      <td>flannel</td>
      <td><a href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/">docs</a></td>
      <td> </td>
      <td>Community (<a href="https://github.com/aveshagarwal">@aveshagarwal</a>)</td>
    </tr>
  </tbody>
</table>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/fedora/flannel_multi_node_cluster.md?pixel" alt="Analytics" /></a></p>
        
	
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/getting-started-guides/fedora/flannel_multi_node_cluster/",
                "title" : "Fedora (Multi Node)",
                "permalink" : "http://kubernetes.github.io/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
	
        
          <a href="/editdocs#docs/getting-started-guides/fedora/flannel_multi_node_cluster.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
