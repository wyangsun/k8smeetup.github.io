
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Concepts">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Secret" />
    

    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Secret | Kubernetes</title>
<meta property="og:title" content="Secret" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/concepts/configuration/secret/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/concepts/configuration/secret/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"name":null,"description":"Production-Grade Container Orchestration","author":null,"@type":"WebPage","url":"http://0.0.0.0:4000/docs/concepts/configuration/secret/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"image":null,"headline":"Secret","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.8 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                  <li><a href="https://kubernetes.io/docs/home/">v1.8</a></li>
                
                  <li><a href="https://v1-7.docs.kubernetes.io/docs/home/">v1.7</a></li>
                
                  <li><a href="https://v1-6.docs.kubernetes.io/docs/home/">v1.6</a></li>
                
                  <li><a href="https://v1-5.docs.kubernetes.io/docs/">v1.5</a></li>
                
                  <li><a href="https://v1-4.docs.kubernetes.io/docs/">v1.4</a></li>
                
                </ul>
              </li>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Concepts</h1>
  <h5>Detailed explanations of Kubernetes system concepts and abstractions.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" class="YAH">CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="Concepts" href="/docs/concepts/"></a>
    
  

  
    <div class="item" data-title="Overview">
      <div class="container">
        
  

    

    
      <a class="item" data-title="认识 Kubernetes?" href="/docs/concepts/overview/what-is-kubernetes/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes 组件" href="/docs/concepts/overview/components/"></a>
    
  

  
    <div class="item" data-title="Working with Kubernetes Objects">
      <div class="container">
        
  

    

    
      <a class="item" data-title="理解 Kubernetes 对象" href="/docs/concepts/overview/working-with-objects/kubernetes-objects/"></a>
    
  

  

    

    
      <a class="item" data-title="Names" href="/docs/concepts/overview/working-with-objects/names/"></a>
    
  

  

    

    
      <a class="item" data-title="Namespaces" href="/docs/concepts/overview/working-with-objects/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="Labels 和 Selectors" href="/docs/concepts/overview/working-with-objects/labels/"></a>
    
  

  

    

    
      <a class="item" data-title="Annotations" href="/docs/concepts/overview/working-with-objects/annotations/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Kubernetes API" href="/docs/concepts/overview/kubernetes-api/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Kubernetes Architecture">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Nodes" href="/docs/concepts/architecture/nodes/"></a>
    
  

  

    

    
      <a class="item" data-title="Master 节点通信" href="/docs/concepts/architecture/master-node-communication/"></a>
    
  

  

    

    
      <a class="item" data-title="云控制器管理器的基础概念" href="/docs/concepts/architecture/cloud-controller/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extending Kubernetes">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Extending your Kubernetes Cluster" href="/docs/concepts/overview/extending/"></a>
    
  

  
    <div class="item" data-title="Extending the Kubernetes API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用聚合层扩展Kubernetes API" href="/docs/concepts/api-extension/apiserver-aggregation/"></a>
    
  

  

    

    
      <a class="item" data-title="自定义资源" href="/docs/concepts/api-extension/custom-resources/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Compute, Storage, and Networking Extensions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Sysctls in a Kubernetes Cluster" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Service Catalog" href="/docs/concepts/service-catalog/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Containers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Images" href="/docs/concepts/containers/images/"></a>
    
  

  

    

    
      <a class="item" data-title="容器环境变量" href="/docs/concepts/containers/container-environment-variables/"></a>
    
  

  

    

    
      <a class="item" data-title="容器生命周期的钩子" href="/docs/concepts/containers/container-lifecycle-hooks/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Workloads">
      <div class="container">
        
  
    <div class="item" data-title="Pods">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Pod Overview" href="/docs/concepts/workloads/pods/pod-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Pods" href="/docs/concepts/workloads/pods/pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 生命周期" href="/docs/concepts/workloads/pods/pod-lifecycle/"></a>
    
  

  

    

    
      <a class="item" data-title="Init 容器" href="/docs/concepts/workloads/pods/init-containers/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod Preset" href="/docs/concepts/workloads/pods/podpreset/"></a>
    
  

  

    

    
      <a class="item" data-title="Disruptions" href="/docs/concepts/workloads/pods/disruptions/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Controllers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Replica Sets" href="/docs/concepts/workloads/controllers/replicaset/"></a>
    
  

  

    

    
      <a class="item" data-title="Replication Controller" href="/docs/concepts/workloads/controllers/replicationcontroller/"></a>
    
  

  

    

    
      <a class="item" data-title="Deployment" href="/docs/concepts/workloads/controllers/deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="StatefulSet" href="/docs/concepts/workloads/controllers/statefulset/"></a>
    
  

  

    

    
      <a class="item" data-title="Daemon Sets" href="/docs/concepts/workloads/controllers/daemonset/"></a>
    
  

  

    

    
      <a class="item" data-title="垃圾收集" href="/docs/concepts/workloads/controllers/garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="Jobs - Run to Completion" href="/docs/concepts/workloads/controllers/jobs-run-to-completion/"></a>
    
  

  

    

    
      <a class="item" data-title="Cron Job" href="/docs/concepts/workloads/controllers/cron-jobs/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Configuration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="配置最佳实践" href="/docs/concepts/configuration/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Managing Compute Resources for Containers" href="/docs/concepts/configuration/manage-compute-resources-container/"></a>
    
  

  

    

    
      <a class="item" data-title="Assigning Pods to Nodes" href="/docs/concepts/configuration/assign-pod-node/"></a>
    
  

  

    

    
      <a class="item" data-title="Taint 和 Toleration" href="/docs/concepts/configuration/taint-and-toleration/"></a>
    
  

  

    

    
      <a class="item" data-title="Secret" href="/docs/concepts/configuration/secret/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 kubeconfig 文件组织集群访问" href="/docs/concepts/configuration/organize-cluster-access-kubeconfig/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 优先级和抢占" href="/docs/concepts/configuration/pod-priority-preemption/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Services, Load Balancing, and Networking">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Service" href="/docs/concepts/services-networking/service/"></a>
    
  

  

    

    
      <a class="item" data-title="DNS Pod 与 Service" href="/docs/concepts/services-networking/dns-pod-service/"></a>
    
  

  

    

    
      <a class="item" data-title="应用连接到 Service" href="/docs/concepts/services-networking/connect-applications-service/"></a>
    
  

  

    

    
      <a class="item" data-title="Ingress resource" href="/docs/concepts/services-networking/ingress/"></a>
    
  

  

    

    
      <a class="item" data-title="Network Policies" href="/docs/concepts/services-networking/network-policies/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 HostAliases 向 Pod /etc/hosts 文件添加条目" href="/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Storage">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Volumes" href="/docs/concepts/storage/volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="Persistent Volumes" href="/docs/concepts/storage/persistent-volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="Storage Classes" href="/docs/concepts/storage/storage-classes/"></a>
    
  

  

    

    
      <a class="item" data-title="Dynamic Volume Provisioning" href="/docs/concepts/storage/dynamic-provisioning/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Cluster Administration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="集群管理概述" href="/docs/concepts/cluster-administration/cluster-administration-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="证书" href="/docs/concepts/cluster-administration/certificates/"></a>
    
  

  

    

    
      <a class="item" data-title="云供应商" href="/docs/concepts/cluster-administration/cloud-providers/"></a>
    
  

  

    

    
      <a class="item" data-title="Managing Resources" href="/docs/concepts/cluster-administration/manage-deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="集群网络" href="/docs/concepts/cluster-administration/networking/"></a>
    
  

  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="日志架构" href="/docs/concepts/cluster-administration/logging/"></a>
    
  

  

    

    
      <a class="item" data-title="配置 kubelet 垃圾收集" href="/docs/concepts/cluster-administration/kubelet-garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="Federation" href="/docs/concepts/cluster-administration/federation/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Sysctls in a Kubernetes Cluster" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  

  

    

    
  

  

    

    
  

  

    

    
      <a class="item" data-title="Proxies in Kubernetes" href="/docs/concepts/cluster-administration/proxies/"></a>
    
  

  

    

    
      <a class="item" data-title="Controller manager metrics" href="/docs/concepts/cluster-administration/controller-metrics/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  
    <div class="item" data-title="Policies">
      <div class="container">
        
  

    

    
      <a class="item" data-title="资源配额" href="/docs/concepts/policy/resource-quotas/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 安全策略" href="/docs/concepts/policy/pod-security-policy/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/concepts/configuration/secret.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Secret</h1>
        

        <p><code class="highlighter-rouge">Secret</code> 对象类型用来保存敏感信息，例如密码、OAuth 令牌和 ssh key。将这些信息放在 <code class="highlighter-rouge">secret</code> 中比放在 <code class="highlighter-rouge">pod</code> 的定义或者 docker 镜像中来说更加安全和灵活。参阅 <a href="https://git.k8s.io/community/contributors/design-proposals/secrets.md">Secret 设计文档</a> 获取更多详细信息。</p>

<ul id="markdown-toc">
  <li><a href="#secret-概览" id="markdown-toc-secret-概览">Secret 概览</a>    <ul>
      <li><a href="#内置-secret" id="markdown-toc-内置-secret">内置 secret</a>        <ul>
          <li><a href="#service-account-使用-api-凭证自动创建和附加-secret" id="markdown-toc-service-account-使用-api-凭证自动创建和附加-secret">Service Account 使用 API 凭证自动创建和附加 secret</a></li>
        </ul>
      </li>
      <li><a href="#创建您自己的-secret" id="markdown-toc-创建您自己的-secret">创建您自己的 Secret</a>        <ul>
          <li><a href="#使用-kubectl-创建-secret" id="markdown-toc-使用-kubectl-创建-secret">使用 kubectl 创建 Secret</a></li>
          <li><a href="#手动创建-secret" id="markdown-toc-手动创建-secret">手动创建 Secret</a></li>
          <li><a href="#解码-secret" id="markdown-toc-解码-secret">解码 Secret</a></li>
        </ul>
      </li>
      <li><a href="#使用-secret" id="markdown-toc-使用-secret">使用 Secret</a>        <ul>
          <li><a href="#在-pod-中使用-secret-文件" id="markdown-toc-在-pod-中使用-secret-文件">在 Pod 中使用 Secret 文件</a></li>
          <li><a href="#secret-作为环境变量" id="markdown-toc-secret-作为环境变量">Secret 作为环境变量</a></li>
          <li><a href="#使用-imagepullsecret" id="markdown-toc-使用-imagepullsecret">使用 imagePullSecret</a></li>
        </ul>
      </li>
      <li><a href="#安排-imagepullsecrets-自动附加" id="markdown-toc-安排-imagepullsecrets-自动附加">安排 imagePullSecrets 自动附加</a>        <ul>
          <li><a href="#自动挂载手动创建的-secret" id="markdown-toc-自动挂载手动创建的-secret">自动挂载手动创建的 Secret</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#详细" id="markdown-toc-详细">详细</a>    <ul>
      <li><a href="#限制" id="markdown-toc-限制">限制</a></li>
      <li><a href="#secret-与-pod-生命周期的联系" id="markdown-toc-secret-与-pod-生命周期的联系">Secret 与 Pod 生命周期的联系</a></li>
    </ul>
  </li>
  <li><a href="#使用案例" id="markdown-toc-使用案例">使用案例</a>    <ul>
      <li><a href="#使用案例包含-ssh-密钥的-pod" id="markdown-toc-使用案例包含-ssh-密钥的-pod">使用案例：包含 ssh 密钥的 pod</a></li>
      <li><a href="#使用案例包含-prodtest-凭据的-pod" id="markdown-toc-使用案例包含-prodtest-凭据的-pod">使用案例：包含 prod/test 凭据的 pod</a></li>
      <li><a href="#使用案例secret-卷中以点号开头的文件" id="markdown-toc-使用案例secret-卷中以点号开头的文件">使用案例：secret 卷中以点号开头的文件</a></li>
      <li><a href="#使用案例secret-仅对-pod-中的一个容器可见" id="markdown-toc-使用案例secret-仅对-pod-中的一个容器可见">使用案例：Secret 仅对 pod 中的一个容器可见</a></li>
    </ul>
  </li>
  <li><a href="#最佳实践" id="markdown-toc-最佳实践">最佳实践</a>    <ul>
      <li><a href="#客户端使用-secret-api" id="markdown-toc-客户端使用-secret-api">客户端使用 secret API</a></li>
    </ul>
  </li>
  <li><a href="#安全属性" id="markdown-toc-安全属性">安全属性</a>    <ul>
      <li><a href="#保护" id="markdown-toc-保护">保护</a></li>
      <li><a href="#风险" id="markdown-toc-风险">风险</a></li>
    </ul>
  </li>
</ul>

<h2 id="secret-概览">Secret 概览</h2>

<p>Secret 是一种包含少量敏感信息例如密码、token 或 key 的对象。这样的信息可能会被放在 Pod spec 中或者镜像中；将其放在一个 secret 对象中可以更好地控制它的用途，并降低意外暴露的风险。</p>

<p>用户可以创建 secret，同时系统也创建了一些 secret。</p>

<p>要使用 secret，pod 需要引用 secret。Pod 可以用两种方式使用 secret：作为 <a href="/docs/concepts/storage/volumes/">volume</a> 中的文件被挂载到 pod 中的一个或者多个容器里，或者当 kubelet 为 pod 拉取镜像时使用。</p>

<h3 id="内置-secret">内置 secret</h3>

<h4 id="service-account-使用-api-凭证自动创建和附加-secret">Service Account 使用 API 凭证自动创建和附加 secret</h4>

<p>Kubernetes 自动创建包含访问 API 凭据的 secret，并自动修改您的 pod 以使用此类型的 secret。</p>

<p>如果需要，可以禁用或覆盖自动创建和使用API凭据。但是，如果您需要的只是安全地访问 apiserver，我们推荐这样的工作流程。</p>

<p>参阅  <a href="/docs/user-guide/service-accounts">Service Account</a> 文档获取关于 Service Account 如何工作的更多信息。</p>

<h3 id="创建您自己的-secret">创建您自己的 Secret</h3>

<h4 id="使用-kubectl-创建-secret">使用 kubectl 创建 Secret</h4>

<p>假设有些 pod 需要访问数据库。这些 pod 需要使用的用户名和密码在您本地机器的 <code class="highlighter-rouge">./username.txt</code> 和 <code class="highlighter-rouge">./password.txt</code> 文件里。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create files needed for rest of example.</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"admin"</span> <span class="o">&gt;</span> ./username.txt
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"1f2d1e2e67df"</span> <span class="o">&gt;</span> ./password.txt
</code></pre></div></div>

<p><code class="highlighter-rouge">kubectl create secret</code> 命令将这些文件打包到一个 Secret 中并在 API server 中创建了一个对象。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create secret generic db-user-pass <span class="nt">--from-file</span><span class="o">=</span>./username.txt <span class="nt">--from-file</span><span class="o">=</span>./password.txt
secret <span class="s2">"db-user-pass"</span> created
</code></pre></div></div>

<p>您可以这样检查刚创建的 secret：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get secrets
NAME                  TYPE                                  DATA      AGE
db-user-pass          Opaque                                2         51s

<span class="nv">$ </span>kubectl describe secrets/db-user-pass
Name:            db-user-pass
Namespace:       default
Labels:          &lt;none&gt;
Annotations:     &lt;none&gt;

Type:            Opaque

Data
<span class="o">====</span>
password.txt:    12 bytes
username.txt:    5 bytes
</code></pre></div></div>

<p>请注意，默认情况下，<code class="highlighter-rouge">get</code> 和 <code class="highlighter-rouge">describe</code> 命令都不会显示文件的内容。这是为了防止将 secret 中的内容被意外暴露给从终端日志记录中刻意寻找它们的人。</p>

<p>请参阅 <a href="#decoding-a-secret">解码 secret</a> 了解如何查看它们的内容。</p>

<h4 id="手动创建-secret">手动创建 Secret</h4>

<p>您也可以先以 json 或 yaml 格式在文件中创建一个 secret 对象，然后创建该对象。</p>

<p>每一项必须是 base64 编码：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"admin"</span> | base64
<span class="nv">YWRtaW4</span><span class="o">=</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"1f2d1e2e67df"</span> | base64
MWYyZDFlMmU2N2Rm
</code></pre></div></div>

<p>现在可以像这样写一个 secret 对象：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mysecret</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">YWRtaW4=</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">MWYyZDFlMmU2N2Rm</span>
</code></pre></div></div>

<p>数据字段是一个映射。它的键必须匹配 <a href="https://git.k8s.io/community/contributors/design-proposals/identifiers.md"><code class="highlighter-rouge">DNS_SUBDOMAIN</code></a>，前导点也是可以的。这些值可以是任意数据，使用 base64 进行编码。</p>

<p>使用  <a href="/docs/user-guide/kubectl/v1.7/#create"><code class="highlighter-rouge">kubectl create</code></a> 创建 secret：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> ./secret.yaml
secret <span class="s2">"mysecret"</span> created
</code></pre></div></div>

<p><strong>编码注意：</strong> secret 数据的序列化 JSON 和 YAML 值使用 base64 编码成字符串。换行符在这些字符串中无效，必须省略。当在 Darwin/OS X 上使用 <code class="highlighter-rouge">base64</code> 实用程序时，用户应避免使用 <code class="highlighter-rouge">-b</code> 选项来拆分长行。另外，对于 Linux 用户如果 <code class="highlighter-rouge">-w</code> 选项不可用的话，应该添加选项 <code class="highlighter-rouge">-w 0</code> 到 <code class="highlighter-rouge">base64</code> 命令或管道 <code class="highlighter-rouge">base64 | tr -d '\n' </code> 。</p>

<h4 id="解码-secret">解码 Secret</h4>

<p>可以使用 <code class="highlighter-rouge">kubectl get secret</code> 命令获取 secret。例如，获取在上一节中创建的 secret：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get secret mysecret <span class="nt">-o</span> yaml
apiVersion: v1
data:
  username: <span class="nv">YWRtaW4</span><span class="o">=</span>
  password: MWYyZDFlMmU2N2Rm
kind: Secret
metadata:
  creationTimestamp: 2016-01-22T18:41:56Z
  name: mysecret
  namespace: default
  resourceVersion: <span class="s2">"164619"</span>
  selfLink: /api/v1/namespaces/default/secrets/mysecret
  uid: cfee02d6-c137-11e5-8d73-42010af00002
<span class="nb">type</span>: Opaque
</code></pre></div></div>

<p>解码密码字段：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"MWYyZDFlMmU2N2Rm"</span> | base64 <span class="nt">--decode</span>
1f2d1e2e67df
</code></pre></div></div>

<h3 id="使用-secret">使用 Secret</h3>

<p>Secret 可以作为数据卷被挂载，或作为环境变量暴露出来以供 pod 中的容器使用。它们也可以被系统的其他部分使用，而不直接暴露在 pod 内。例如，它们可以保存凭据，系统的其他部分应该用它来代表您与外部系统进行交互。</p>

<h4 id="在-pod-中使用-secret-文件">在 Pod 中使用 Secret 文件</h4>

<p>在 Pod 中的 volume 里使用 Secret：</p>

<ol>
  <li>创建一个 secret 或者使用已有的 secret。多个 pod 可以引用同一个 secret。</li>
  <li>修改您的 pod 的定义在 <code class="highlighter-rouge">spec.volumes[]</code> 下增加一个 volume。可以给这个 volume 随意命名，它的 <code class="highlighter-rouge">spec.volumes[].secret.secretName</code> 必须等于 secret 对象的名字。</li>
  <li>将 <code class="highlighter-rouge">spec.containers[].volumeMounts[]</code> 加到需要用到该 secret 的容器中。指定 <code class="highlighter-rouge">spec.containers[].volumeMounts[].readOnly = true</code> 和 <code class="highlighter-rouge">spec.containers[].volumeMounts[].mountPath</code> 为您想要该 secret 出现的尚未使用的目录。</li>
  <li>修改您的镜像并且／或者命令行让程序从该目录下寻找文件。Secret 的 <code class="highlighter-rouge">data</code> 映射中的每一个键都成为了 <code class="highlighter-rouge">mountPath</code> 下的一个文件名。</li>
</ol>

<p>这是一个在 pod 中使用 volume 挂在 secret 的例子：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/foo"</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">mysecret</span>
</code></pre></div></div>

<p>您想要用的每个 secret 都需要在 <code class="highlighter-rouge">spec.volumes</code> 中指明。</p>

<p>如果 pod 中有多个容器，每个容器都需要自己的 <code class="highlighter-rouge">volumeMounts</code> 配置块，但是每个 secret 只需要一个 <code class="highlighter-rouge">spec.volumes</code>。</p>

<p>您可以打包多个文件到一个 secret 中，或者使用的多个 secret，怎样方便就怎样来。</p>

<p><strong>向特性路径映射 secret 密钥</strong></p>

<p>我们还可以控制 Secret key 映射在 volume 中的路径。您可以使用 <code class="highlighter-rouge">spec.volumes[].secret.items</code> 字段修改每个 key 的目标路径：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/foo"</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">mysecret</span>
      <span class="na">items</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">username</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">my-group/my-username</span>
</code></pre></div></div>

<p>将会发生什么呢：</p>

<ul>
  <li><code class="highlighter-rouge">username</code> secret 存储在 <code class="highlighter-rouge">/etc/foo/my-group/my-username</code> 文件中而不是 <code class="highlighter-rouge">/etc/foo/username</code> 中。</li>
  <li><code class="highlighter-rouge">password</code> secret 没有被映射</li>
</ul>

<p>如果使用了 <code class="highlighter-rouge">spec.volumes[].secret.items</code>，只有在 <code class="highlighter-rouge">items</code> 中指定的 key 被映射。要使用 secret 中所有的 key，所有这些都必须列在 <code class="highlighter-rouge">items</code> 字段中。所有列出的密钥必须存在于相应的 secret 中。否则，不会创建卷。</p>

<p><strong>Secret 文件权限</strong></p>

<p>您还可以指定 secret 将拥有的权限模式位文件。如果不指定，默认使用 <code class="highlighter-rouge">0644</code>。您可以为整个保密卷指定默认模式，如果需要，可以覆盖每个密钥。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/foo"</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">mysecret</span>
      <span class="na">defaultMode</span><span class="pi">:</span> <span class="s">256</span>
</code></pre></div></div>

<p>然后，secret 将被挂载到 <code class="highlighter-rouge">/etc/foo</code> 目录，所有通过该 secret volume 挂载创建的文件的权限都是 <code class="highlighter-rouge">0400</code>。</p>

<p>请注意，JSON 规范不支持八进制符号，因此使用 256 值作为 0400 权限。如果您使用 yaml 而不是 json 作为 pod，则可以使用八进制符号以更自然的方式指定权限。</p>

<p>您还可以使用映射，如上一个示例，并为不同的文件指定不同的权限，如下所示：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/foo"</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">mysecret</span>
      <span class="na">items</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">username</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">my-group/my-username</span>
        <span class="na">mode</span><span class="pi">:</span> <span class="s">511</span>
</code></pre></div></div>

<p>在这种情况下，导致 <code class="highlighter-rouge">/etc/foo/my-group/my-username</code> 的文件的权限值为 <code class="highlighter-rouge">0777</code>。由于 JSON 限制，必须以十进制格式指定模式。</p>

<p>请注意，如果稍后阅读此权限值可能会以十进制格式显示。</p>

<p><strong>从 Volume 中消费 secret 值</strong></p>

<p>在挂载的 secret volume 的容器内，secret key 将作为文件，并且 secret 的值使用 base-64 解码并存储在这些文件中。这是在上面的示例容器内执行的命令的结果：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> /etc/foo/
username
password
<span class="nv">$ </span><span class="nb">cat</span> /etc/foo/username
admin
<span class="nv">$ </span><span class="nb">cat</span> /etc/foo/password
1f2d1e2e67df
</code></pre></div></div>

<p>容器中的程序负责从文件中读取 secret。</p>

<p><strong>挂载的 secret 被自动更新</strong></p>

<p>当已经在 volume 中被消费的 secret 被更新时，被映射的 key 也将被更新。</p>

<p>Kubelet 在周期性同步时检查被挂载的 secret 是不是最新的。但是，它正在使用其基于本地 ttl 的缓存来获取当前的 secret 值。结果是，当 secret 被更新的时刻到将新的 secret 映射到 pod 的时刻的总延迟可以与 kubelet 中的secret 缓存的 kubelet sync period + ttl 一样长。</p>

<h4 id="secret-作为环境变量">Secret 作为环境变量</h4>

<p>将 secret 作为 pod 中的环境变量使用：</p>

<ol>
  <li>创建一个 secret 或者使用一个已存在的 secret。多个 pod 可以引用同一个 secret。</li>
  <li>修改 Pod 定义，为每个要使用 secret 的容器添加对应 secret key 的环境变量。消费secret key 的环境变量应填充 secret 的名称，并键入 <code class="highlighter-rouge">env[x].valueFrom.secretKeyRef</code>。</li>
  <li>修改镜像并／或者命令行，以便程序在指定的环境变量中查找值。</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-env-pod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mycontainer</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">env</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">SECRET_USERNAME</span>
        <span class="na">valueFrom</span><span class="pi">:</span>
          <span class="na">secretKeyRef</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">mysecret</span>
            <span class="na">key</span><span class="pi">:</span> <span class="s">username</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">SECRET_PASSWORD</span>
        <span class="na">valueFrom</span><span class="pi">:</span>
          <span class="na">secretKeyRef</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">mysecret</span>
            <span class="na">key</span><span class="pi">:</span> <span class="s">password</span>
  <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Never</span>
</code></pre></div></div>

<p><strong>消费环境变量里的 Secret 值</strong></p>

<p>在一个消耗环境变量 secret 的容器中，secret key 作为包含 secret 数据的 base-64 解码值的常规环境变量。这是从上面的示例在容器内执行的命令的结果：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$SECRET_USERNAME</span>
admin
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$SECRET_PASSWORD</span>
1f2d1e2e67df
</code></pre></div></div>

<h4 id="使用-imagepullsecret">使用 imagePullSecret</h4>

<p>imagePullSecret 是将包含 Docker（或其他）镜像注册表密码的 secret 传递给 Kubelet 的一种方式，因此可以代表您的 pod 拉取私有镜像。</p>

<p><strong>手动指定 imagePullSecret</strong></p>

<p>imagePullSecret 的使用在 <a href="/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod">镜像文档</a> 中说明。</p>

<h3 id="安排-imagepullsecrets-自动附加">安排 imagePullSecrets 自动附加</h3>

<p>您可以手动创建 imagePullSecret，并从 serviceAccount 引用它。使用该 serviceAccount 创建的任何 pod 和默认使用该 serviceAccount 的 pod 将会将其的 imagePullSecret 字段设置为服务帐户的 imagePullSecret 字段。有关该过程的详细说明，请参阅 <a href="/docs/tasks/configure-pod-container/configure-service-account/#adding-imagepullsecrets-to-a-service-account">将 ImagePullSecrets 添加到服务帐户</a>。</p>

<h4 id="自动挂载手动创建的-secret">自动挂载手动创建的 Secret</h4>

<p>手动创建的 secret（例如包含用于访问 github 帐户的令牌）可以根据其服务帐户自动附加到 pod。请参阅 <a href="/docs/tasks/run-application/podpreset/">使用 PodPreset 向 Pod 中注入信息</a> 以获取该进程的详细说明。</p>

<h2 id="详细">详细</h2>

<h3 id="限制">限制</h3>

<p>验证 secret volume 来源确保指定的对象引用实际上指向一个类型为 Secret 的对象。因此，需要在依赖于它的任何 pod 之前创建一个 secret。</p>

<p>Secret API 对象驻留在命名空间中。它们只能由同一命名空间中的 pod 引用。</p>

<p>每个 secret 的大小限制为1MB。这是为了防止创建非常大的 secret 会耗尽 apiserver 和 kubelet 的内存。然而，创建许多较小的 secret 也可能耗尽内存。更全面得限制 secret 对内存使用的功能还在计划中。</p>

<p>Kubelet 仅支持从 API server 获取的 Pod 使用 secret。这包括使用 kubectl 创建的任何 pod，或间接通过 replication controller 创建的 pod。它不包括通过 kubelet <code class="highlighter-rouge">--manifest-url</code> 标志，其 <code class="highlighter-rouge">--config</code> 标志或其 REST API 创建的pod（这些不是创建 pod 的常用方法）。</p>

<p>必须先创建 secret，除非将它们标记为可选项，否则必须在将其作为环境变量在 pod 中使用之前创建 secret。对不存在的 secret 的引用将阻止其启动。</p>

<p>通过 <code class="highlighter-rouge">secretKeyRef</code> 对不存在于命名的 key 中的 key 进行引用将阻止该启动。</p>

<p>用于通过 <code class="highlighter-rouge">envFrom</code> 填充环境变量的 secret，这些环境变量具有被认为是无效环境变量名称的 key 将跳过这些键。该 pod 将被允许启动。将会有一个事件，其原因是 <code class="highlighter-rouge">InvalidVariableNames</code>，该消息将包含被跳过的无效键的列表。该示例显示一个 pod，它指的是包含2个无效键，1badkey 和 2alsobad 的默认/mysecret ConfigMap。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get events
LASTSEEN   FIRSTSEEN   COUNT     NAME            KIND      SUBOBJECT                         TYPE      REASON
0s         0s          1         dapi-test-pod   Pod                                         Warning   InvalidEnvironmentVariableNames   kubelet, 127.0.0.1      Keys <span class="o">[</span>1badkey, 2alsobad] from the EnvFrom secret default/mysecret were skipped since they are considered invalid environment variable names.
</code></pre></div></div>

<h3 id="secret-与-pod-生命周期的联系">Secret 与 Pod 生命周期的联系</h3>

<p>通过 API 创建 Pod 时，不会检查应用的 secret 是否存在。一旦 Pod 被调度，kubelet 就会尝试获取该 secret 的值。如果获取不到该 secret，或者暂时无法与 API server 建立连接，kubelet 将会定期重试。Kubelet 将会报告关于 pod 的事件，并解释它无法启动的原因。一旦获取到 secret，kubelet将创建并装载一个包含它的卷。在所有 pod 的卷被挂载之前，都不会启动 pod 的容器。</p>

<h2 id="使用案例">使用案例</h2>

<h3 id="使用案例包含-ssh-密钥的-pod">使用案例：包含 ssh 密钥的 pod</h3>

<p>创建一个包含 ssh key 的 secret：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create secret generic ssh-key-secret <span class="nt">--from-file</span><span class="o">=</span>ssh-privatekey<span class="o">=</span>/path/to/.ssh/id_rsa <span class="nt">--from-file</span><span class="o">=</span>ssh-publickey<span class="o">=</span>/path/to/.ssh/id_rsa.pub
</code></pre></div></div>

<p><strong>安全性注意事项</strong>：发送自己的 ssh 密钥之前要仔细思考：集群的其他用户可能有权访问该密钥。使用您想要共享 Kubernetes 群集的所有用户可以访问的服务帐户，如果它们遭到入侵，可以撤销。</p>

<p>现在我们可以创建一个使用 ssh 密钥引用 secret 的pod，并在一个卷中使用它：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-test-pod</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">secret-test</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-volume</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">ssh-key-secret</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ssh-test-container</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mySshImage</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-volume</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/secret-volume"</span>
</code></pre></div></div>

<p>当容器中的命令运行时，密钥的片段将可在以下目录：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/secret-volume/ssh-publickey
/etc/secret-volume/ssh-privatekey
</code></pre></div></div>

<p>然后容器可以自由使用密钥数据建立一个 ssh 连接。</p>

<h3 id="使用案例包含-prodtest-凭据的-pod">使用案例：包含 prod/test 凭据的 pod</h3>

<p>下面的例子说明一个 pod 消费一个包含 prod 凭据的 secret，另一个 pod 使用测试环境凭据消费 secret。</p>

<p>创建 secret：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create secret generic prod-db-secret <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">username</span><span class="o">=</span>produser <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">password</span><span class="o">=</span>Y4nys7f11
secret <span class="s2">"prod-db-secret"</span> created
<span class="nv">$ </span>kubectl create secret generic test-db-secret <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">username</span><span class="o">=</span>testuser <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">password</span><span class="o">=</span>iluvtests
secret <span class="s2">"test-db-secret"</span> created
</code></pre></div></div>

<p>创建 pod ：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">List</span>
<span class="na">items</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
  <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">prod-db-client-pod</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">prod-db-client</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-volume</span>
      <span class="na">secret</span><span class="pi">:</span>
        <span class="na">secretName</span><span class="pi">:</span> <span class="s">prod-db-secret</span>
    <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">db-client-container</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">myClientImage</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-volume</span>
        <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/secret-volume"</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
  <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">test-db-client-pod</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">test-db-client</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-volume</span>
      <span class="na">secret</span><span class="pi">:</span>
        <span class="na">secretName</span><span class="pi">:</span> <span class="s">test-db-secret</span>
    <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">db-client-container</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">myClientImage</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-volume</span>
        <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/secret-volume"</span>
</code></pre></div></div>

<p>这两个容器将在其文件系统上显示以下文件，其中包含每个容器环境的值：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/secret-volume/username
/etc/secret-volume/password
</code></pre></div></div>

<p>请注意，两个 pod 的 spec 配置中仅有一个字段有所不同；这有助于使用普通的 pod 配置模板创建具有不同功能的 pod。您可以使用两个 service account 进一步简化基本 pod spec：一个名为 <code class="highlighter-rouge">prod-user</code> 拥有  <code class="highlighter-rouge">prod-db-secret</code> ，另一个称为 <code class="highlighter-rouge">test-user</code> 拥有 <code class="highlighter-rouge">test-db-secret</code> 。然后，pod spec 可以缩短为，例如：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">prod-db-client-pod</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">prod-db-client</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">serviceAccount</span><span class="pi">:</span> <span class="s">prod-db-client</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">db-client-container</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myClientImage</span>
</code></pre></div></div>

<h3 id="使用案例secret-卷中以点号开头的文件">使用案例：secret 卷中以点号开头的文件</h3>

<p>为了将数据“隐藏”起来（即文件名以点号开头的文件），简单地说让该键以一个点开始。例如，当如下 secret 被挂载到卷中：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">dotfile-secret</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="s">.secret-file</span><span class="pi">:</span> <span class="s">dmFsdWUtMg0KDQo=</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secret-dotfiles-pod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-volume</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">dotfile-secret</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">dotfile-test-container</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">gcr.io/google_containers/busybox</span>
    <span class="na">command</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ls</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">-l"</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">/etc/secret-volume"</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">secret-volume</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/secret-volume"</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Secret-volume</code> 将包含一个单独的文件，叫做 <code class="highlighter-rouge">.secret-file</code>，<code class="highlighter-rouge">dotfile-test-container</code> 的 <code class="highlighter-rouge">/etc/secret-volume/.secret-file</code> 路径下将有该文件。</p>

<p><strong>注意</strong></p>

<p>以点号开头的文件在 <code class="highlighter-rouge">ls -l</code> 的输出中被隐藏起来了；列出目录内容时，必须使用 <code class="highlighter-rouge">ls -la</code> 才能查看它们。</p>

<h3 id="使用案例secret-仅对-pod-中的一个容器可见">使用案例：Secret 仅对 pod 中的一个容器可见</h3>

<p>考虑以下一个需要处理 HTTP 请求的程序，执行一些复杂的业务逻辑，然后使用 HMAC 签署一些消息。因为它具有复杂的应用程序逻辑，所以在服务器中可能会出现一个未被注意的远程文件读取漏洞，这可能会将私钥暴露给攻击者。</p>

<p>这可以在两个容器中分为两个进程：前端容器，用于处理用户交互和业务逻辑，但无法看到私钥；以及可以看到私钥的签名者容器，并且响应来自前端的简单签名请求（例如通过本地主机网络）。</p>

<p>使用这种分割方法，攻击者现在必须欺骗应用程序服务器才能进行任意的操作，这可能比使其读取文件更难。</p>

<h2 id="最佳实践">最佳实践</h2>

<h3 id="客户端使用-secret-api">客户端使用 secret API</h3>

<p>当部署与 secret API 交互的应用程序时，应使用诸如 <a href="https://kubernetes.io/docs/admin/authorization/rbac/">RBAC</a> 之类的 <a href="https://kubernetes.io/docs/admin/authorization/">授权策略</a> 来限制访问。</p>

<p>Secret 中的值对于不同的环境来说重要性可能不同，例如对于 Kubernetes 集群内部（例如 service account 令牌）和集群外部来说就不一样。即使一个应用程序可以理解其期望的与之交互的 secret 有多大的能力，但是同一命名空间中的其他应用程序却可能不这样认为。</p>

<p>由于这些原因，在命名空间中 <code class="highlighter-rouge">watch</code> 和 <code class="highlighter-rouge">list</code>  secret 的请求是非常强大的功能，应该避免这样的行为，因为列出 secret 可以让客户端检查所有 secret 是否在该命名空间中。在群集中<code class="highlighter-rouge">watch</code> 和 <code class="highlighter-rouge">list</code> 所有 secret 的能力应该只保留给最有特权的系统级组件。</p>

<p>需要访问 secrets API 的应用程序应该根据他们需要的 secret 执行 <code class="highlighter-rouge">get</code> 请求。这允许管理员限制对所有 secret 的访问，同时设置 <a href="https://kubernetes.io/docs/admin/authorization/rbac/#referring-to-resources">白名单访问</a> 应用程序需要的各个实例。</p>

<p>为了提高循环获取的性能，客户端可以设计引用 secret 的资源，然后 <code class="highlighter-rouge">watch</code> 资源，在引用更改时重新请求 secret。此外，还提出了一种 <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/bulk_watch.md">”批量监控“ API</a> 来让客户端 <code class="highlighter-rouge">watch</code> 每个资源，该功能可能会在将来的 Kubernetes 版本中提供。</p>

<h2 id="安全属性">安全属性</h2>

<h3 id="保护">保护</h3>

<p>因为 <code class="highlighter-rouge">secret</code> 对象可以独立于使用它们的 <code class="highlighter-rouge">pod</code> 而创建，所以在创建、查看和编辑 pod 的流程中 secret 被暴露的风险较小。系统还可以对 <code class="highlighter-rouge">secret</code> 对象采取额外的预防措施，例如避免将其写入到磁盘中可能的位置。</p>

<p>只有当节点上的 pod 需要用到该 secret 时，该 secret 才会被发送到该节点上。它不会被写入磁盘，而是存储在 tmpfs 中。一旦依赖于它的 pod 被删除，它就被删除。</p>

<p>在大多数 Kubernetes 项目维护的发行版中，用户与 API server 之间的通信以及从 API server 到 kubelet 的通信都受到 SSL/TLS 的保护。通过这些通道传输时，secret 受到保护。</p>

<p>节点上的 secret 数据存储在 tmpfs 卷中，因此不会传到节点上的其他磁盘。</p>

<p>同一节点上的很多个 pod 可能拥有多个 secret。但是，只有 pod 请求的 secret 在其容器中才是可见的。因此，一个 pod 不能访问另一个 Pod 的 secret。</p>

<p>Pod 中有多个容器。但是，pod 中的每个容器必须请求其挂载卷中的 secret 卷才能在容器内可见。这可以用于 <a href="#use-case-secret-visible-to-one-container-in-a-pod">在 Pod 级别构建安全分区</a>。</p>

<h3 id="风险">风险</h3>

<ul>
  <li>API server 的 secret 数据以纯文本的方式存储在 etcd 中；因此：
    <ul>
      <li>管理员应该限制 admin 用户访问 etcd；</li>
      <li>API server 中的 secret 数据位于 etcd 使用的磁盘上；管理员可能希望在不再使用时擦除/粉碎 etcd 使用的磁盘</li>
    </ul>
  </li>
  <li>如果您将 secret 数据编码为 base64 的清单（JSON 或 YAML）文件，共享该文件或将其检入代码库，这样的话该密码将会被泄露。 Base64 编码不是一种加密方式，一样也是纯文本。</li>
  <li>应用程序在从卷中读取 secret 后仍然需要保护 secret 的值，例如不会意外记录或发送给不信任方。</li>
  <li>可以创建和使用 secret 的 pod 的用户也可以看到该 secret 的值。即使 API server 策略不允许用户读取 secret 对象，用户也可以运行暴露 secret 的 pod。</li>
  <li>如果运行了多个副本，那么这些 secret 将在它们之间共享。默认情况下，etcd 不能保证与 SSL/TLS 的对等通信，尽管可以进行配置。</li>
  <li>目前，任何节点的 root 用户都可以通过模拟 kubelet 来读取 API server 中的任何 secret。只有向实际需要它们的节点发送 secret 才能限制单个节点的根漏洞的影响，该功能还在计划中。</li>
</ul>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/concepts/configuration/secret.md?pixel" alt="Analytics" /></a></p>
        
	
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/concepts/configuration/secret/",
                "title" : "Secret",
                "permalink" : "http://kubernetes.github.io/docs/concepts/configuration/secret/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
	
        
          <a href="/editdocs#docs/concepts/configuration/secret.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
